var rideID=[],rideLat=[],rideLng=[],myLat=null,myLng=null,shortestDistance=null,nearestID=null,nearestLat=null,nearestLng=null;function initMap(){navigator.geolocation&&navigator.geolocation.getCurrentPosition(e=>{let t={lat:e.coords.latitude,lng:e.coords.longitude};myLat=e.coords.latitude,myLng=e.coords.longitude;let n=new google.maps.Map(document.getElementById("map"),{zoom:10,center:t}),a=new google.maps.Marker({position:t,map:n,title:"Your Location",animation:google.maps.Animation.DROP});var i="username=xXoDw780&lat="+t.lat+"&lng="+t.lng,r=new XMLHttpRequest;r.open("POST","https://jordan-marsh.herokuapp.com/rides",!0),r.setRequestHeader("Content-type","application/x-www-form-urlencoded"),r.send(i),r.onload=function(){let e=JSON.parse(this.responseText);var t=0;e.forEach(function(e){var a=[];rideID[t]=e.id,rideLat[t]=e.lat,rideLng[t]=e.lng,a[t]=new google.maps.Marker({position:{lat:e.lat,lng:e.lng},map:n,title:"Vehicle ID:"+rideID[t],animation:google.maps.Animation.DROP,icon:"carForMaps.png"}),a[t].addListener("click",function(){c.open(n,a[t])}),t+=1});for(let i=0;i<t;i++){var r=new google.maps.LatLng(rideLat[i],rideLng[i]),o=new google.maps.LatLng(myLat,myLng),s=621371e-9*google.maps.geometry.spherical.computeDistanceBetween(r,o);0==i&&(shortestDistance=s,nearestID=rideID[0],nearestLat=rideLat[0],nearestLng=rideLng[0]),s<shortestDistance&&(shortestDistance=s,nearestID=rideID[i],nearestLat=rideLat[i],nearestLng=rideLng[i])}let l=[{lat:myLat,lng:myLng},{lat:nearestLat,lng:nearestLng},],d=new google.maps.Polyline({path:l,geodesic:!0,strokeColor:"#FF0000",strokeOpacity:1,strokeWeight:3});d.setMap(n);var p='<div id="info"><h1>My Nearest Ride</h1><p> The nearest ride from your location is RIDE ID: '+nearestID+" which is "+Math.trunc(shortestDistance)+" miles away at lat: "+nearestLat+" lng: "+nearestLng+"</p></div>",c=new google.maps.InfoWindow({content:p});a.addListener("click",function(){c.open(n,a)})}})}window.initMap=initMap;